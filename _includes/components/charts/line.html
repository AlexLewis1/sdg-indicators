{% assign id = page.indicator | slugify %}
{% assign unit_label = page.variable_unit_label %}


<div id="series">
  <select>
    <option value="">All</option>
  </select>
</div>

<canvas id='linechart-{{ id }}'></canvas>
<script>

var chartInstance;


var datasetObject = {
    fill: false,
    lineTension: 0.1,
    borderCapStyle: 'butt',
    borderDash: [],
    borderDashOffset: 0.0,
    borderJoinStyle: 'miter',
    pointBorderColor: 'rgba(75,192,192,1)',
    pointBackgroundColor: '',
    pointBorderWidth: 1,
    pointHoverRadius: 5,
    pointHoverBackgroundColor: 'rgba(75,192,192,1)',
    pointHoverBorderColor: 'rgba(220,220,220,1)',
    pointHoverBorderWidth: 2,
    pointRadius: 5,
    pointHitRadius: 10,
    spanGaps: false
};

var data = {{include.data}};

// initially, get overall:
var dm = new dataManager(data, datasetObject);
var chartInfo = dm.getChartInfo(null);
createPlot(chartInfo);

////////////////////////////////////////////////////////////////////////////////////////////////
var $seriesSelect = $('#series select');
$seriesSelect.on('change', function() {
  var seriesType = $(this).find('option:selected').val();
  var chartInfo = dm.getChartInfo(seriesType ? seriesType : null);
  createPlot(chartInfo);
});
dm.getSeriesLabels(data).forEach(function(series) {
  $seriesSelect.append($('<option/>').attr('value', series).text(series));
});
////////////////////////////////////////////////////////////////////////////////////////////////


function createPlot(chartInfo) {

  if(chartInstance) {
    chartInstance.destroy();
  }

  chartInstance = new Chart(document.getElementById('linechart-{{ id }}'), {
    type: 'line',
    data: chartInfo,
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          xAxes: [{
              gridLines: {
                  color: '#ccc',
              }
          }],
          yAxes: [{
            ticks: {
                suggestedMin: 0
            }
          }]
        },
        legend: {
          display: true
        }
    }
  });
}

</script>
